FROM node:lts

ARG ASCLEPIOS_SSE_CLIENT_VER=0.1.4
ARG XNAT_DATA_CLIENT_VERSION=1.7.6

ENV NODE_PATH=/usr/local/lib/node_modules

RUN apt-get update && apt-get install -y \
    default-jre-headless && \
    rm -rf /var/lib/apt/lists/*

RUN npm install -g \
    asclepios-sse-client@${ASCLEPIOS_SSE_CLIENT_VER}

RUN wget https://bitbucket.org/xnatdev/data-client/downloads/XnatDataClient-${XNAT_DATA_CLIENT_VERSION}-all.jar -O /opt/XnatDataClient.jar

ADD XnatDataClient /usr/bin/XnatDataClient
ADD upload_subject /usr/bin/upload_subject
ADD update_subject /usr/bin/update_subject


LABEL org.nrg.commands="[{\"inputs\": [{\"command-line-flag\": null, \"name\": \"subject\", \"default-value\": null, \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#SUBJECT#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Input subject\"}, {\"command-line-flag\": null, \"name\": \"sse-server-url\", \"default-value\": \"http://sse:8080\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#SSE_SERVER_URL#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"SSE server url\"}, {\"command-line-flag\": null, \"name\": \"ta-url\", \"default-value\": \"http://ta:8000\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#TA_URL#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Trusted Authority url\"}, {\"command-line-flag\": null, \"name\": \"key-g\", \"default-value\": \"123\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#KEY_G#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Symmetric key, which is shared between users and TA\"}, {\"command-line-flag\": null, \"name\": \"kenc\", \"default-value\": \"123\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#KENC#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Symmetric key, which is shared between users who are allowed to upload/search data\"}, {\"command-line-flag\": null, \"name\": \"salt-value\", \"default-value\": \"abc123!?\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#SALT_VALUE#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Salt Value\"}, {\"command-line-flag\": null, \"name\": \"iv-value\", \"default-value\": \"abcdefg\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#IV_VALUE#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"IV Value\"}], \"description\": \"Upload subject data to the ASCLEPIOS symmetric searchable encryption service\", \"command-line\": \"upload_subject #SUBJECT#\", \"outputs\": [], \"image\": \"somnonetz/snet-asclepios-sse-client:latest\", \"container-labels\": {}, \"override-entrypoint\": true, \"label\": \"Upload Subject to ASCLEPIOS SSE\", \"network\": \"asclepios\", \"version\": \"1.5\", \"schema-version\": \"1.0\", \"xnat\": [{\"description\": \"Upload subject data to the ASCLEPIOS symmetric searchable encryption service\", \"contexts\": [\"xnat:subjectData\"], \"name\": \"sse-upload-subject\", \"output-handlers\": [], \"label\": \"Upload Subject to ASCLEPIOS SSE\", \"external-inputs\": [{\"provides-value-for-command-input\": \"subject\", \"name\": \"subject\", \"default-value\": null, \"sensitive\": null, \"matcher\": null, \"required\": true, \"provides-files-for-command-mount\": null, \"replacement-key\": null, \"via-setup-command\": null, \"user-settable\": null, \"load-children\": false, \"type\": \"Subject\", \"description\": \"Input subject\"}], \"derived-inputs\": []}], \"mounts\": [], \"environment-variables\": {\"SSE_CLIENT_KENC\": \"#KENC#\", \"SSE_CLIENT_KEY_G\": \"#KEY_G#\", \"SSE_CLIENT_TA_URL\": \"#TA_URL#\", \"SSE_CLIENT_SALT_VALUE\": \"#SALT_VALUE#\", \"SSE_CLIENT_IV_VALUE\": \"#IV_VALUE#\", \"SSE_CLIENT_SSE_SERVER_URL\": \"#SSE_SERVER_URL#\"}, \"type\": \"docker\", \"ports\": {}, \"name\": \"sse-upload-subject\"}, \
	{\"inputs\": [{\"command-line-flag\": null, \"name\": \"subject\", \"default-value\": null, \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#SUBJECT#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Input subject\"}, {\"command-line-flag\": null, \"name\": \"sse-server-url\", \"default-value\": \"http://sse:8080\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#SSE_SERVER_URL#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"SSE server url\"}, {\"command-line-flag\": null, \"name\": \"ta-url\", \"default-value\": \"http://ta:8000\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#TA_URL#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Trusted Authority url\"}, {\"command-line-flag\": null, \"name\": \"key-g\", \"default-value\": \"123\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#KEY_G#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Symmetric key, which is shared between users and TA\"}, {\"command-line-flag\": null, \"name\": \"kenc\", \"default-value\": \"123\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#KENC#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Symmetric key, which is shared between users who are allowed to update/search data\"}, {\"command-line-flag\": null, \"name\": \"salt-value\", \"default-value\": \"abc123!?\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#SALT_VALUE#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"Salt Value\"}, {\"command-line-flag\": null, \"name\": \"iv-value\", \"default-value\": \"abcdefg\", \"sensitive\": null, \"matcher\": null, \"false-value\": null, \"required\": true, \"true-value\": null, \"replacement-key\": \"#IV_VALUE#\", \"command-line-separator\": null, \"type\": \"string\", \"description\": \"IV Value\"}], \"description\": \"Update subject data on the ASCLEPIOS symmetric searchable encryption service\", \"command-line\": \"update_subject #SUBJECT#\", \"outputs\": [], \"image\": \"somnonetz/snet-asclepios-sse-client:latest\", \"container-labels\": {}, \"override-entrypoint\": true, \"label\": \"Update Subject on ASCLEPIOS SSE\", \"network\": \"asclepios\", \"version\": \"1.5\", \"schema-version\": \"1.0\", \"xnat\": [{\"description\": \"Update subject data on the ASCLEPIOS symmetric searchable encryption service\", \"contexts\": [\"xnat:subjectData\"], \"name\": \"sse-update-subject\", \"output-handlers\": [], \"label\": \"Update Subject on ASCLEPIOS SSE\", \"external-inputs\": [{\"provides-value-for-command-input\": \"subject\", \"name\": \"subject\", \"default-value\": null, \"sensitive\": null, \"matcher\": null, \"required\": true, \"provides-files-for-command-mount\": null, \"replacement-key\": null, \"via-setup-command\": null, \"user-settable\": null, \"load-children\": false, \"type\": \"Subject\", \"description\": \"Input subject\"}], \"derived-inputs\": []}], \"mounts\": [], \"environment-variables\": {\"SSE_CLIENT_KENC\": \"#KENC#\", \"SSE_CLIENT_KEY_G\": \"#KEY_G#\", \"SSE_CLIENT_TA_URL\": \"#TA_URL#\", \"SSE_CLIENT_SALT_VALUE\": \"#SALT_VALUE#\", \"SSE_CLIENT_IV_VALUE\": \"#IV_VALUE#\", \"SSE_CLIENT_SSE_SERVER_URL\": \"#SSE_SERVER_URL#\"}, \"type\": \"docker\", \"ports\": {}, \"name\": \"sse-update-subject\"}]"
